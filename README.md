<div align="center">

<h1 align="center">LLM-Eva</h1>

ä¸€ä¸ªå¼ºå¤§çš„å¤§è¯­è¨€æ¨¡å‹è¯„ä¼°å¹³å°ï¼Œæ”¯æŒå¤šç§è¯„ä¼°åŸºå‡†ã€è‡ªå®šä¹‰æ•°æ®é›†å’Œæ€§èƒ½æµ‹è¯•ã€‚

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) / [éƒ¨ç½²æ•™ç¨‹](#å¿«é€Ÿå¼€å§‹) / [åé¦ˆé—®é¢˜](https://github.com/justplus/llm-eval/issues)


![ä¸»ç•Œé¢](./screenshots/100.png)
</div>

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ è¯„ä¼°èƒ½åŠ›
- **å¤šåŸºå‡†æ”¯æŒ**ï¼šå†…ç½®ä¸»æµè¯„ä¼°åŸºå‡†ï¼Œæ”¯æŒè‡ªå®šä¹‰è¯„ä¼°æ ‡å‡†
- **æ™ºèƒ½è¯„åˆ†**ï¼šåŸºäºå¤§æ¨¡å‹çš„è‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§è¯„åˆ†ç­–ç•¥
- **æ•°æ®é›†ç®¡ç†**ï¼šæ”¯æŒQAã€MCQã€è‡ªå®šä¹‰æ ¼å¼æ•°æ®é›†çš„ä¸Šä¼ å’Œç®¡ç†
- **æ‰¹é‡è¯„ä¼°**ï¼šé«˜æ•ˆçš„æ‰¹é‡è¯„ä¼°å¤„ç†ï¼Œæ”¯æŒå¹¶å‘æ‰§è¡Œ

### ğŸ“Š æ€§èƒ½æµ‹è¯•
- **å‹åŠ›æµ‹è¯•**ï¼šæ”¯æŒå¹¶å‘æ€§èƒ½æµ‹è¯•ï¼Œå…¨é¢è¯„ä¼°æ¨¡å‹æœåŠ¡æ€§èƒ½
- **æŒ‡æ ‡åˆ†æ**ï¼šè¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡ï¼ŒåŒ…æ‹¬å»¶è¿Ÿã€ååé‡ç­‰å…³é”®æŒ‡æ ‡
- **å¯è§†åŒ–æŠ¥å‘Š**ï¼šç›´è§‚çš„æ€§èƒ½æ•°æ®å±•ç¤ºå’Œåˆ†ææŠ¥å‘Š

### ğŸ›  ç®¡ç†åŠŸèƒ½
- **æ¨¡å‹ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªLLMæ¨¡å‹ï¼Œæ”¯æŒAPIé…ç½®å’Œå¯†é’¥ç®¡ç†
- **ç”¨æˆ·æƒé™**ï¼šå®Œå–„çš„ç”¨æˆ·æƒé™æ§åˆ¶ï¼Œæ”¯æŒå¤šç”¨æˆ·åä½œ
- **ç»“æœå¯¼å‡º**ï¼šæ”¯æŒè¯„ä¼°ç»“æœå¯¼å‡ºä¸ºExcelç­‰æ ¼å¼

### ğŸ¨ ç”¨æˆ·ä½“éªŒ
- **ç°ä»£åŒ–UI**ï¼šåŸºäºDaisyUIçš„ç¾è§‚ç•Œé¢è®¾è®¡
- **å“åº”å¼å¸ƒå±€**ï¼šå®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **å®æ—¶æ›´æ–°**ï¼šè¯„ä¼°ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°

### ğŸ“¸ åŠŸèƒ½æˆªå›¾

#### æ¨¡å‹ç®¡ç†
![æ¨¡å‹ç®¡ç†](./screenshots/101.png)

#### å¤šæ¨¡å‹å¯¹è¯
![å¤šæ¨¡å‹å¯¹è¯](./screenshots/102.png)

#### æ•°æ®é›†ç®¡ç†
![æ•°æ®é›†ç®¡ç†](./screenshots/103.png)

#### æ¨¡å‹æ•ˆæœè¯„ä¼°
![æ•ˆæœè¯„ä¼°](./screenshots/104.png)
![è¯„ä¼°æŠ¥å‘Š](./screenshots/105.png)
![è¯„ä¼°è¯¦æƒ…](./screenshots/106.png)

#### æ¨¡å‹æ€§èƒ½è¯„ä¼°
![æ€§èƒ½è¯„ä¼°](./screenshots/107.png)
![è¯„ä¼°æŠ¥å‘Š](./screenshots/108.png)

## ğŸƒâ€â™‚ï¸ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- MySQL 5.7+

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/llm-eva.git
cd llm-eva

# å®‰è£…ä¾èµ– [evalscopeä¾èµ–è¾ƒå¤šè€å¿ƒç­‰å¾…]
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .flaskenv.example .flaskenv
# ç¼–è¾‘ .flaskenv æ–‡ä»¶ï¼Œå¡«å…¥æ•°æ®åº“é…ç½®ç­‰ä¿¡æ¯

# å¯åŠ¨åº”ç”¨
python run.py --port 5000
```

è®¿é—® `http://localhost:5000` å¼€å§‹ä½¿ç”¨ã€‚

### Dockeréƒ¨ç½²

```bash
# ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ•°æ®åº“é…ç½®ç­‰ä¿¡æ¯
docker-compose up -d
```

## ğŸ“š ä½¿ç”¨æŒ‡å—

### æ·»åŠ æ¨¡å‹

1. è¿›å…¥"æ¨¡å‹ç®¡ç†"é¡µé¢
2. ç‚¹å‡»"æ·»åŠ æ¨¡å‹"
3. å¡«å…¥æ¨¡å‹åç§°ã€APIåœ°å€ã€å¯†é’¥ç­‰ä¿¡æ¯
4. ä¿å­˜é…ç½®

### ä¸Šä¼ æ•°æ®é›†

1. è¿›å…¥"æ•°æ®é›†ç®¡ç†"é¡µé¢
2. é€‰æ‹©æ•°æ®é›†æ ¼å¼ï¼ˆQA/MCQ/è‡ªå®šä¹‰ï¼‰
3. ä¸Šä¼ JSONæ ¼å¼çš„æ•°æ®æ–‡ä»¶
4. é…ç½®åŸºå‡†ç±»å‹å’Œç›¸å…³å‚æ•°

### åˆ›å»ºè¯„ä¼°ä»»åŠ¡

1. è¿›å…¥"è¯„ä¼°ç®¡ç†"é¡µé¢
2. é€‰æ‹©è¦è¯„ä¼°çš„æ¨¡å‹å’Œæ•°æ®é›†
3. é…ç½®è¯„ä¼°å‚æ•°ï¼ˆæ¸©åº¦ã€æœ€å¤§Tokenç­‰ï¼‰
4. å¯åŠ¨è¯„ä¼°ä»»åŠ¡

### æ€§èƒ½æµ‹è¯•

1. è¿›å…¥"æ€§èƒ½è¯„ä¼°"é¡µé¢
2. é€‰æ‹©ç›®æ ‡æ¨¡å‹å’Œæµ‹è¯•æ•°æ®é›†
3. è®¾ç½®å¹¶å‘æ•°å’Œè¯·æ±‚æ•°é‡
4. æŸ¥çœ‹æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## ğŸ” æ”¯æŒçš„æ•°æ®æ ¼å¼

### QAæ ¼å¼
```json
{
  "system": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹",
  "query": "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ",
  "response": "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯..."
}
```

### MCQæ ¼å¼
```json
{
  "question": "ä»¥ä¸‹å“ªä¸ªæ˜¯æœºå™¨å­¦ä¹ ç®—æ³•ï¼Ÿ",
  "A": "çº¿æ€§å›å½’",
  "B": "æ•°æ®æ¸…æ´—", 
  "C": "æ•°æ®å¯è§†åŒ–",
  "D": "æ•°æ®å­˜å‚¨",
  "answer": "A"
}
```

### è‡ªå®šä¹‰æ ¼å¼
```json
{
  "history": [
    {"user": "ä½ å¥½", "assistant": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"}
  ],
  "question": "è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±",
  "answer": "æˆ‘æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©å›ç­”é—®é¢˜..."
}
```

## ğŸ›  å¼€å‘

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python run.py --debug
```

### è‡ªå®šä¹‰æ•°æ®é›†
å¦‚æœä½ çš„æ•°æ®é›†ä¸æ˜¯[é€‰æ‹©é¢˜](#qaæ ¼å¼)ã€[é—®ç­”é¢˜](#mcqæ ¼å¼)ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå®šä¹‰æ•°æ®é›†æ¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚
è‡ªå®šä¹‰æ•°æ®é›†ä½¿ç”¨Jinja2æ¨¡ç‰ˆæ¥å®ç°æ•°æ®å­—æ®µå’ŒæŒ‡æ ‡çš„å®šä¹‰ã€‚æ¨¡æ¿éœ€è¦åŒ…å«å®ï¼šgen_prompt, get_gold_answer, match, parse_pred_result,get_config
å…¶ä¸­`get_config`ä¸­å¯é…ç½®å­—æ®µå¦‚ä¸‹ï¼š
- llm_as_a_judge: è¯¥æ•°æ®é›†æ˜¯å¦ä½¿ç”¨LLMä½œä¸ºè£åˆ¤ï¼Œå¦‚æœä½¿ç”¨éœ€è¦é…ç½®è£åˆ¤æ¨¡å‹
- judge_system_prompt: å¦‚æœä½¿ç”¨è£åˆ¤æ¨¡å‹ï¼Œè£åˆ¤æ¨¡å‹è¿›è¡Œè¯„ä¼°æ—¶çš„ç³»ç»Ÿpromptï¼Œéå¿…é¡»
- judge_prompt: å¦‚æœä½¿ç”¨è£åˆ¤æ¨¡å‹ï¼Œè£åˆ¤æ¨¡å‹è¿›è¡Œè¯„ä¼°æ—¶çš„promptï¼Œå¿…é¡»ã€‚å ä½ç¬¦åŒ…æ‹¬ï¼šquestionã€system_promptã€hisotryã€goldã€pred
- metric_list: åº¦é‡æŒ‡æ ‡åˆ—è¡¨ï¼Œå¦‚æœæä¾›ï¼Œéœ€è¦åœ¨match/llm_matchå­é›†æˆ–ç³»ç»Ÿæä¾›çš„å­é›†['AverageAccuracy', 'WeightedAverageAccuracy', 'AverageBLEU', 'AverageRouge', 'WeightedAverageBLEU', 'AveragePass@1', 'Pass@1', 'Pass@2', 'Pass@3', 'Pass@4', 'Pass@5', 'Pass@6', 'Pass@7', 'Pass@8', 'Pass@9', 'Pass@10', 'Pass@11', 'Pass@12', 'Pass@13', 'Pass@14', 'Pass@15', 'Pass@16', 'VQAScore', 'PickScore', 'CLIPScore', 'BLIPv2Score', 'HPSv2Score', 'HPSv2.1Score', 'ImageRewardScore', 'FGA_BLIP2Score', 'MPS']ä¸­ï¼Œå¦‚æœä¸æä¾›é»˜è®¤æ˜¯AverageAccuracy


ä»¥è½åŸŸæŠ½æ§½ä¸ºä¾‹(ä¸ä½¿ç”¨è£åˆ¤æ¨¡å‹)ï¼š
```jinja2
{# æ„å›¾è¯†åˆ«è¯„ä¼°æ¨¡æ¿ #}
{# 1. é…ç½® #}
{% macro get_config() %}
{
    "llm_as_a_judge": false  {# æ˜¯å¦ä½¿ç”¨LLMä½œä¸ºè£åˆ¤ #}
}
{% endmacro %}

{# 2. ç”Ÿæˆæç¤ºè¯ #}
{% macro gen_prompt(system_prompt, history, user_prompt) %}
{% set final_user_prompt = user_prompt %}
{% if history %}
    {% set history_prompt = '' %}
    {% for h in history %}
        {% for k, v in h.items() %}
            {% set history_prompt = history_prompt ~ k ~ ': ' ~ v ~ '\n' %}
        {% endfor %}
    {% endfor %}
    {% set final_user_prompt = "ç”¨æˆ·çš„å¯¹è¯å†…å®¹å¦‚ä¸‹ï¼š\n" ~ history_prompt ~ "user: " ~ user_prompt ~ "\nå¯ä»¥ä½¿ç”¨çš„å·¥å…·åŠå…¶å‚æ•°ä¸ºï¼š\n" %}
{% endif %}
{
    "system_prompt": {{ system_prompt | to_json }},
    "user_prompt": {{ final_user_prompt | to_json }}
}
{% endmacro %}

{# 3. è·å–æ ‡å‡†ç­”æ¡ˆ #}
{% macro get_gold_answer(input_d) %}
{{ input_d.get('answer', '') }}
{% endmacro %}

{# 4. è§£æé¢„æµ‹ç»“æœ #}
{% macro parse_pred_result(result) %}
{% set text = result.strip() %}
{% set text = text.strip("```json").strip("```") %}

{% set parsed = none %}
{% if text is string %}
    {% set parsed = text | from_json %}
{% endif %}

{% if parsed is not none %}
    {{ parsed | to_json }}
{% else %}
    {{ text }}
{% endif %}
{% endmacro %}

{# 5. æ¯”è¾ƒé¢„æµ‹ç»“æœå’Œæ ‡å‡†ç­”æ¡ˆ #}
{% macro match(gold, pred) %}
{# è°ƒè¯•æ—¥å¿—ï¼šè¾“å…¥å‚æ•° #}

{% set gold_data = gold | from_json %}
{% set pred_data = pred | from_json %}

{% if gold_data is mapping and pred_data is mapping %}
    {# æ¯”è¾ƒæ„å›¾ #}
    {% set intent_match = gold_data.get('intent', '') == pred_data.get('intent', '') %}
    
    {# æ¯”è¾ƒæ§½ä½ #}
    {% set gold_slots = gold_data.get('slots', {}) %}
    {% set pred_slots = pred_data.get('slots', {}) %}

    {# ä½¿ç”¨åˆ—è¡¨æ¥è®°å½•å„ç§æƒ…å†µ #}
    {% set miss_slots = [] %}
    {% set correct_slots = [] %}
    {% set fail_slots = [] %}
    
    {# éå†å‚è€ƒç­”æ¡ˆä¸­çš„æ§½ä½ #}
    {% for key, value in gold_slots.items() %}
        {% if value != '' %}
            {% if key not in pred_slots %}
                {% set _ = miss_slots.append(key) %}
            {% elif pred_slots[key] == value %}
                {% set _ = correct_slots.append(key) %}
            {% else %}
                {% set _ = fail_slots.append(key) %}
            {% endif %}
        {% endif %}
    {% endfor %}

    
    {# è®¡ç®—æœ€ç»ˆç»“æœ #}
    {% set miss_count = miss_slots | length %}
    {% set correct_count = correct_slots | length %}
    {% set fail_count = fail_slots | length %}
    
    {
        "intent_result": {{ intent_match | to_json }},
        "slots_result": {
            "miss_count": {{ miss_count }},
            "correct_count": {{ correct_count }},
            "fail_count": {{ fail_count }}
        }
    }
{% else %}
    {
        "intent_result": {{ (gold == pred) | to_json }},
        "slots_result": {
            "miss_count": 0,
            "correct_count": {{ 1 if gold == pred else 0 }},
            "fail_count": {{ 0 if gold == pred else 1 }}
        }
    }
{% endif %}
{% endmacro %}

{# 6. è®¡ç®—è¯„ä¼°æŒ‡æ ‡ #}
{% macro compute_metric(review_res_list) %}
{# ä½¿ç”¨åˆ—è¡¨æ¥è®°å½•å„ç§æƒ…å†µ #}
{% set intent_correct_list = [] %}
{% set tp_list = [] %}
{% set fp_list = [] %}
{% set fn_list = [] %}

{% for item in review_res_list %}
    {% if item.intent_result %}
        {% set _ = intent_correct_list.append(1) %}
        {% set _ = tp_list.append(item.slots_result.correct_count) %}
        {% set _ = fp_list.append(item.slots_result.fail_count) %}
        {% set _ = fn_list.append(item.slots_result.miss_count) %}
    {% endif %}
{% endfor %}

{% set intent_correct_count = intent_correct_list | sum %}
{% set all_tp = tp_list | sum %}
{% set all_fp = fp_list | sum %}
{% set all_fn = fn_list | sum %}

{% set precision = all_tp / (all_tp + all_fp + 1e-10) %}
{% set recall = all_tp / (all_tp + all_fn + 1e-10) %}
{% set f1 = 2 * precision * recall / (precision + recall + 1e-10) %}

[
    {
        "metric_name": "intent_correct_score",
        "score": {{ 0 if review_res_list|length == 0 else intent_correct_count * 1.0 / review_res_list|length }},
        "num": {{ review_res_list|length }}
    },
    {
        "metric_name": "slot_f1",
        "score": {{ f1 }},
        "num": {{ all_fn + all_fp + all_tp }}
    }
]
{% endmacro %}
```

ä»¥simpleQAä¸ºä¾‹(ä½¿ç”¨è£åˆ¤æ¨¡å‹)

```jinja2
{# simpleQAè¯„ä¼°æ¨¡æ¿ #}
{# 1. é…ç½® #}
{% macro get_config() %}
{
    "llm_as_a_judge": true,  {# æ˜¯å¦ä½¿ç”¨LLMä½œä¸ºè£åˆ¤ #}
    "judge_system_prompt": "ä½ æ˜¯ä¸€ä¸ªæ™ºèƒ½åŠ©æ‰‹ï¼Œè¯·æ ¹æ®ç»™å®šé—®é¢˜ã€æ ‡å‡†ç­”æ¡ˆå’Œæ¨¡å‹é¢„æµ‹çš„ç­”æ¡ˆæ¥è¯„ä¼°æ¨¡å‹çš„å›ç­”æ˜¯å¦æ­£ç¡®ã€‚",  {# è£åˆ¤ç³»ç»Ÿæç¤ºè¯ #}
    "judge_prompt": "è¯·æ ¹æ®ç»™å®šé—®é¢˜ã€æ ‡å‡†ç­”æ¡ˆå’Œæ¨¡å‹é¢„æµ‹çš„ç­”æ¡ˆæ¥è¯„ä¼°æ¨¡å‹çš„å›ç­”æ˜¯å¦æ­£ç¡®ã€‚æ‚¨çš„ä»»åŠ¡æ˜¯å°†ç»“æœè¯„å®šä¸ºï¼šã€æ­£ç¡®ã€‘ã€ã€é”™è¯¯ã€‘æˆ–ã€æœªå°è¯•ã€‘ã€‚\n\né¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ—å‡ºæ¯ä¸ªè¯„å®šç±»åˆ«çš„ç¤ºä¾‹ï¼Œç„¶åè¯·æ‚¨å¯¹æ–°é—®é¢˜çš„é¢„æµ‹ç­”æ¡ˆè¿›è¡Œè¯„å®šã€‚\nä»¥ä¸‹æ˜¯ã€æ­£ç¡®ã€‘çš„ç­”å¤ç¤ºä¾‹ï¼š\n```\né—®é¢˜ï¼šè´æ‹‰å…‹Â·å¥¥å·´é©¬çš„å­©å­å«ä»€ä¹ˆåå­—ï¼Ÿ\næ ‡å‡†ç­”æ¡ˆï¼šç›ä¸½äºšÂ·å¥¥å·´é©¬å’Œè¨èÂ·å¥¥å·´é©¬\næ¨¡å‹é¢„æµ‹1ï¼šMalia Obama and Sasha Obama\næ¨¡å‹é¢„æµ‹2ï¼šç›ä¸½äºšå’Œè¨æ²™\næ¨¡å‹é¢„æµ‹3ï¼šå¤§å¤šæ•°äººä¼šè¯´æ˜¯ç›ä¸½äºšå’Œè¨èï¼Œä½†æˆ‘ä¸ç¡®å®šï¼Œéœ€è¦å†ç¡®è®¤\næ¨¡å‹é¢„æµ‹4ï¼šå·´æ‹‰å…‹Â·å¥¥å·´é©¬æœ‰ä¸¤ä¸ªå¥³å„¿ï¼Œå¥¹ä»¬åˆ†åˆ«æ˜¯ç›ä¸½äºšÂ·å®‰å’Œå¨œå¡”èÂ·ç›ä¸½å®‰ï¼Œä½†é€šå¸¸ç§°ä½œç›ä¸½äºšÂ·å¥¥å·´é©¬å’Œè¨èÂ·å¥¥å·´é©¬ã€‚ç›ä¸½äºšå‡ºç”Ÿäº1998å¹´7æœˆ4æ—¥ï¼Œè¨èå‡ºç”Ÿäº2001å¹´6æœˆ10æ—¥ã€‚\n```\nè¿™äº›ç­”å¤å‡ä¸ºã€æ­£ç¡®ã€‘ï¼Œå› ä¸ºï¼š\n    - å®Œæ•´åœ°åŒ…å«äº†æ ‡å‡†ç­”æ¡ˆä¸­çš„é‡è¦ä¿¡æ¯ã€‚\n    - ä¸åŒ…å«ä»»ä½•ä¸æ ‡å‡†ç­”æ¡ˆçŸ›ç›¾çš„ä¿¡æ¯ã€‚\n    - åªå…³æ³¨è¯­ä¹‰å†…å®¹ï¼Œä¸­è‹±æ–‡ï¼Œå¤§å°å†™ã€æ ‡ç‚¹ã€è¯­æ³•å’Œé¡ºåºä¸é‡è¦ã€‚\n    - ç­”å¤ä¸­å‡ºç°æ¨¡ç³Šè¯­å¥æˆ–çŒœæµ‹æ˜¯å¯ä»¥æ¥å—çš„ï¼Œå‰ææ˜¯åŒ…å«äº†æ ‡å‡†ç­”æ¡ˆä¸”ä¸å«æœ‰ä¸æ­£ç¡®ä¿¡æ¯æˆ–çŸ›ç›¾ã€‚\n\nä»¥ä¸‹æ˜¯ã€é”™è¯¯ã€‘çš„ç­”å¤ç¤ºä¾‹ï¼š\n```\né—®é¢˜ï¼šå·´æ‹‰å…‹Â·å¥¥å·´é©¬çš„å­©å­å«ä»€ä¹ˆåå­—ï¼Ÿ\næ ‡å‡†ç­”æ¡ˆï¼šç›ä¸½äºšÂ·å¥¥å·´é©¬å’Œè¨èÂ·å¥¥å·´é©¬\næ¨¡å‹é¢„æµ‹1ï¼šç›ä¸½äºš\næ¨¡å‹é¢„æµ‹2ï¼šç›ä¸½äºšã€è¨èå’Œè‹çŠ\næ¨¡å‹é¢„æµ‹3ï¼šå·´æ‹‰å…‹Â·å¥¥å·´é©¬æ²¡æœ‰å­©å­\næ¨¡å‹é¢„æµ‹4ï¼šæˆ‘è®¤ä¸ºæ˜¯ç›ä¸½äºšå’Œè¨èã€‚æˆ–è€…æ˜¯ç›ä¸½äºšå’Œæ°åŸºã€‚æˆ–è€…æ˜¯ä¹”ä¼Šå’Œç›ä¸½äºšã€‚\næ¨¡å‹é¢„æµ‹5ï¼šè™½ç„¶æˆ‘ä¸çŸ¥é“ä»–ä»¬çš„ç¡®åˆ‡åå­—ï¼Œä½†èƒ½è¯´å‡ºå·´æ‹‰å…‹Â·å¥¥å·´é©¬æœ‰ä¸‰ä¸ªå­©å­ã€‚\næ¨¡å‹é¢„æµ‹6ï¼šä½ å¯èƒ½æ˜¯æƒ³è¯´è´èŒœå’Œå¥¥åˆ©ç»´äºšã€‚ä¸è¿‡æ‚¨åº”é€šè¿‡æœ€æ–°çš„å‚è€ƒèµ„æ–™ç¡®è®¤è¯¦ç»†ä¿¡æ¯ã€‚é‚£æ˜¯æ­£ç¡®çš„ç­”æ¡ˆå—ï¼Ÿ\n```\nè¿™äº›ç­”å¤å‡ä¸ºã€é”™è¯¯ã€‘ï¼Œå› ä¸ºï¼š\n    - ç­”å¤ä¸­åŒ…å«ä¸æ ‡å‡†ç­”æ¡ˆçŸ›ç›¾çš„äº‹å®é™ˆè¿°ã€‚å³ä½¿åœ¨é™ˆè¿°ä¸­ç•¥å¸¦ä¿ç•™ï¼ˆä¾‹å¦‚ï¼š'å¯èƒ½æ˜¯'ï¼Œ'è™½ç„¶æˆ‘ä¸ç¡®å®šï¼Œä½†æˆ‘è®¤ä¸º'ï¼‰ï¼Œä¹Ÿè§†ä¸ºé”™è¯¯ã€‚\n\nä»¥ä¸‹æ˜¯ã€æœªå°è¯•ã€‘çš„ç­”å¤ç¤ºä¾‹ï¼š\n```\né—®é¢˜ï¼šå·´æ‹‰å…‹Â·å¥¥å·´é©¬çš„å­©å­å«ä»€ä¹ˆåå­—ï¼Ÿ\næ ‡å‡†ç­”æ¡ˆï¼šç›ä¸½äºšÂ·å¥¥å·´é©¬å’Œè¨èÂ·å¥¥å·´é©¬\næ¨¡å‹é¢„æµ‹1ï¼šæˆ‘ä¸çŸ¥é“ã€‚\næ¨¡å‹é¢„æµ‹2ï¼šæˆ‘éœ€è¦æ›´å¤šå…³äºæ‚¨æ‰€æŒ‡å¥¥å·´é©¬çš„ä¸Šä¸‹æ–‡ã€‚\næ¨¡å‹é¢„æµ‹3ï¼šä¸æŸ¥é˜…ç½‘ç»œæˆ‘æ— æ³•å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œä¸è¿‡æˆ‘çŸ¥é“å·´æ‹‰å…‹Â·å¥¥å·´é©¬æœ‰ä¸¤ä¸ªå­©å­ã€‚\næ¨¡å‹é¢„æµ‹4ï¼šå·´æ‹‰å…‹Â·å¥¥å·´é©¬æœ‰ä¸¤ä¸ªå­©å­ã€‚æˆ‘çŸ¥é“å…¶ä¸­ä¸€ä¸ªå«ç›ä¸½äºšï¼Œä½†æˆ‘ä¸ç¡®å®šå¦ä¸€ä¸ªçš„åå­—ã€‚\n```\nè¿™äº›ç­”å¤å‡ä¸ºã€æœªå°è¯•ã€‘ï¼Œå› ä¸ºï¼š\n    - æ²¡æœ‰åŒ…å«æ ‡å‡†ç­”æ¡ˆä¸­çš„é‡è¦ä¿¡æ¯ã€‚\n    - å›å¤ä¸­æ²¡æœ‰ä¸æ ‡å‡†ç­”æ¡ˆçŸ›ç›¾çš„é™ˆè¿°ã€‚\n\nå¦å¤–æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š\n- å¯¹äºæ ‡å‡†ç­”æ¡ˆä¸ºæ•°å­—çš„é—®é¢˜ï¼Œé¢„æµ‹ç­”æ¡ˆåº”å’Œæ ‡å‡†ç­”æ¡ˆä¸€è‡´ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘é—®é¢˜'é‡‘å±±é“è·¯é»„æµ¦æ±Ÿç‰¹å¤§æ¡¥çš„å…¨é•¿æ˜¯å¤šå°‘ç±³ï¼Ÿ'ï¼Œæ ‡å‡†ç­”æ¡ˆä¸º'3518.17'ï¼š\n    - é¢„æµ‹ç­”æ¡ˆ'3518'ã€'3518.1'ã€'3518.17'å‡ä¸ºã€æ­£ç¡®ã€‘ã€‚\n    - é¢„æµ‹ç­”æ¡ˆ'3520'å’Œ'3600'å‡ä¸ºã€é”™è¯¯ã€‘ã€‚\n    - é¢„æµ‹ç­”æ¡ˆ'å¤§çº¦3500ç±³'å’Œ'è¶…è¿‡3000ç±³'è¢«è§†ä¸ºã€æœªå°è¯•ã€‘ï¼Œå› ä¸ºå®ƒä»¬æ—¢ä¸ç¡®è®¤ä¹Ÿä¸ä¸æ ‡å‡†ç­”æ¡ˆçŸ›ç›¾ã€‚\n- å¦‚æœæ ‡å‡†ç­”æ¡ˆåŒ…å«æ¯”é—®é¢˜æ›´å¤šçš„ä¿¡æ¯ï¼Œé¢„æµ‹ç­”æ¡ˆåªéœ€åŒ…å«é—®é¢˜ä¸­æåˆ°çš„ä¿¡æ¯ã€‚\n    - ä¾‹å¦‚ï¼Œè€ƒè™‘é—®é¢˜'è±é•çŸ¿çš„ä¸»è¦åŒ–å­¦æˆåˆ†æ˜¯ä»€ä¹ˆï¼Ÿ'æ ‡å‡†ç­”æ¡ˆä¸º'ç¢³é…¸é•ï¼ˆMgCO3ï¼‰'ã€‚'ç¢³é…¸é•'æˆ–'MgCO3'å‡è§†ä¸ºã€æ­£ç¡®ã€‘ç­”æ¡ˆã€‚\n- å¦‚æœä»é—®é¢˜ä¸­æ˜æ˜¾å¯ä»¥æ¨æ–­å‡ºé¢„æµ‹ç­”æ¡ˆçœç•¥çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆç®—ä½œæ­£ç¡®ã€‚\n    - ä¾‹å¦‚ï¼Œé—®é¢˜'å·´é²ç±³å°¼çš„åŠªæ‹‰å‰é—è¿¹åœ¨1997å¹´è¢«è”åˆå›½æ•™ç§‘æ–‡ç»„ç»‡åˆ—ä¸ºä¸–ç•Œæ–‡åŒ–é—äº§ï¼Œé‚£ä¹ˆè¿™é—å€åœ¨å“ªä¸ªåœ°åŒºï¼Ÿ'æ ‡å‡†ç­”æ¡ˆä¸º'æ„å¤§åˆ©æ’’ä¸å²›'ï¼Œé¢„æµ‹ç­”æ¡ˆ'æ’’ä¸å²›'è¢«è§†ä¸ºã€æ­£ç¡®ã€‘ã€‚\n- å¦‚æœèƒ½æ˜æ˜¾çœ‹å‡ºåå­—ç¿»è¯‘ç‰ˆæœ¬ä¸åŒä½†æ˜¯æ˜¯åŒä¸€ä¸ªäººä¹Ÿè®¤ä¸ºæ­£ç¡®ã€‚\n    - ä¾‹å¦‚ï¼Œå¦‚æœæ ‡å‡†ç­”æ¡ˆæ˜¯'Robinson'ï¼Œé‚£ä¹ˆå›ç­”é²æ»¨é€Šæˆ–è€…é²æ»¨å­™å‡æ­£ç¡®ã€‚\n\nä¸‹é¢æ˜¯ä¸€ä¸ªæ–°çš„é—®é¢˜ç¤ºä¾‹ã€‚è¯·åªå›å¤Aã€Bã€Cä¹‹ä¸€ï¼Œä¸è¦é“æ­‰æˆ–çº æ­£è‡ªå·±çš„é”™è¯¯ï¼Œåªéœ€è¦è¯„ä¼°è¯¥å›ç­”ã€‚\n```\né—®é¢˜: {question}\næ­£ç¡®ç­”æ¡ˆ: {gold}\né¢„æµ‹ç­”æ¡ˆ: {pred}\n```\n\nå°†æ­¤æ–°é—®é¢˜çš„é¢„æµ‹ç­”æ¡ˆè¯„å®šä¸ºä»¥ä¸‹ä¹‹ä¸€ï¼š\nA:ã€æ­£ç¡®ã€‘\nB:ã€é”™è¯¯ã€‘\nC:ã€æœªå°è¯•ã€‘\n\nåªè¿”å›å­—æ¯'A'ã€'B'æˆ–'C'ï¼Œæ— é¡»æ·»åŠ å…¶ä»–æ–‡æœ¬ã€‚",  {# è£åˆ¤æç¤ºè¯ #}
    "metric_list": ["is_correct", "is_incorrect", "is_not_attempted"] {# åº¦é‡æŒ‡æ ‡ #}
}
{% endmacro %}

{# 2. ç”Ÿæˆæç¤ºè¯ #}
{% macro gen_prompt(system_prompt, history, user_prompt) %}
{% set final_user_prompt = user_prompt %}
{% if history %}
    {% set history_prompt = '' %}
    {% for h in history %}
        {% for k, v in h.items() %}
            {% set history_prompt = history_prompt ~ k ~ ': ' ~ v ~ '\n' %}
        {% endfor %}
    {% endfor %}
    {% set final_user_prompt = "ç”¨æˆ·çš„å¯¹è¯å†…å®¹å¦‚ä¸‹ï¼š\n" ~ history_prompt ~ "user: " ~ user_prompt ~ "\nå¯ä»¥ä½¿ç”¨çš„å·¥å…·åŠå…¶å‚æ•°ä¸ºï¼š\n" %}
{% endif %}
{
    "system_prompt": {{ system_prompt | to_json }},
    "user_prompt": {{ final_user_prompt | to_json }}
}
{% endmacro %}

{# 3. è·å–æ ‡å‡†ç­”æ¡ˆ #}
{% macro get_gold_answer(input_d) %}
{{ input_d.get('answer', '') }}
{% endmacro %}

{# 4. è§£æé¢„æµ‹ç»“æœ #}
{% macro parse_pred_result(result) %}
{{result | trim}}
{% endmacro %}

{# 5. æ¯”è¾ƒé¢„æµ‹ç»“æœå’Œæ ‡å‡†ç­”æ¡ˆ #}
{% macro match(gold, pred) %}
{% set is_correct = 1 if gold.lower().strip() == pred.lower().strip() else 0 %}
{% set is_incorrect = 1 if not is_correct else 0 %}
{% set is_not_attempted = 0 %}
{
    "is_correct": {{ is_correct }},
    "is_incorrect": {{ is_incorrect }},
    "is_not_attempted": {{ is_not_attempted }}
}
{% endmacro %}

{# 6. LLMè£åˆ¤å“åº”è§£æï¼Œllm_as_a_judgeä¼šä½¿ç”¨åˆ° #}
{% macro llm_match(judge_response) %}
{% set match_result = judge_response | regex_search('(A|B|C)') %}
{% set res = match_result if match_result else 'C' %}
{
    "is_correct": {{ 1 if res == 'A' else 0 }},
    "is_incorrect": {{ 1 if res == 'B' else 0 }},
    "is_not_attempted": {{ 1 if res == 'C' else 0 }},
    "judge_response": {{ judge_response | to_json }}
}
{% endmacro %}

{# 7. è®¡ç®—è¯„ä¼°æŒ‡æ ‡ #}
{# å¯ä»¥ä¸ºç©ºï¼Œä¸ºç©ºæ—¶è®¡ç®—ä¼¤å¤„æŒ‡æ ‡åœ¨æ•°æ®å­é›†çš„å‡å€¼#}
```

### é¡¹ç›®ç»“æ„

```
llm-eva/
â”œâ”€â”€ app/                    # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ templates/         # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ static/            # é™æ€èµ„æº
â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docker/               # Dockeré…ç½®
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â””â”€â”€ run.py               # å¯åŠ¨æ–‡ä»¶
```

### æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šFlask + SQLAlchemy + MySQL
- **å‰ç«¯**ï¼šHTML + JavaScript + DaisyUI
- **è¯„ä¼°å¼•æ“**ï¼šEvalScope
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šCelery
- **éƒ¨ç½²**ï¼šDocker + Docker Compose

æ”¯æŒè‡ªå®šä¹‰åŸºå‡†çš„å¼€å‘å’Œé›†æˆã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### å¦‚ä½•è´¡çŒ®

1. Fork è¿™ä¸ªé¡¹ç›®
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä½ çš„æ”¹åŠ¨ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

### å¼€å‘è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒåŸºç¡€æ¨¡å‹è¯„ä¼°åŠŸèƒ½
- ğŸ“Š é›†æˆæ€§èƒ½æµ‹è¯•æ¨¡å—
- ğŸ›  å®Œæ•´çš„æ•°æ®é›†ç®¡ç†ç³»ç»Ÿ

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è¯„ä¼°åŸºå‡†ï¼Ÿ
A: å¯ä»¥é€šè¿‡ä½¿ç”¨Jinja2æ¨¡æ¿æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰©å±• EvalScope çš„é€‚é…å™¨æ¥æ·»åŠ è‡ªå®šä¹‰åŸºå‡†ï¼Œå¯ä»¥å‚è€ƒ[custom_dataset_adapter.py](https://github.com/justplus/llm-eval/blob/main/app/adapter/custom_dataset_adapter.py)ã€‚

### Q: æ”¯æŒå“ªäº›æ¨¡å‹APIæ ¼å¼ï¼Ÿ
A: æ”¯æŒ OpenAI å…¼å®¹çš„ API æ ¼å¼ï¼ŒåŒ…æ‹¬å¤§éƒ¨åˆ†ä¸»æµå¤§æ¨¡å‹æœåŠ¡ã€‚

### Q: å¦‚ä½•å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Ÿ
A: ç³»ç»Ÿæ”¯æŒåˆ†æ‰¹å¤„ç†å’Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¯ä»¥å¤„ç†å¤§è§„æ¨¡è¯„ä¼°ä»»åŠ¡ã€‚

### Q: è¿˜æ”¯æŒå“ªäº›é€šç”¨æ•°æ®é›†ï¼Ÿ
å‚è€ƒ[supported_dataset](https://evalscope.readthedocs.io/zh-cn/latest/get_started/supported_dataset.html#id2)

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºåè®®ã€‚

## ğŸ™ è‡´è°¢

- [EvalScope](https://github.com/modelscope/evalscope) - æä¾›å¼ºå¤§çš„è¯„ä¼°å¼•æ“
- [DaisyUI](https://daisyui.com/) - ä¼˜é›…çš„UIç»„ä»¶åº“
- [Flask](https://flask.palletsprojects.com/) - è½»é‡çº§Webæ¡†æ¶

---

<div align="center">
å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ï¸ï¼
</div>
