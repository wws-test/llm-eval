<div align="center">

<h1 align="center">LLM-Eva</h1>

ä¸€ä¸ªå¼ºå¤§çš„å¤§è¯­è¨€æ¨¡å‹è¯„ä¼°å¹³å°ï¼Œæ”¯æŒå¤šç§è¯„ä¼°åŸºå‡†ã€è‡ªå®šä¹‰æ•°æ®é›†å’Œæ€§èƒ½æµ‹è¯•ã€‚

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) / [éƒ¨ç½²æ•™ç¨‹](#å¿«é€Ÿå¼€å§‹) / [åé¦ˆé—®é¢˜](https://github.com/justplus/llm-eval/issues)


![ä¸»ç•Œé¢](./screenshots/100.png)
</div>

## ğŸš€ åŠŸèƒ½ç‰¹æ€§

### ğŸ¯ è¯„ä¼°èƒ½åŠ›
- **å¤šåŸºå‡†æ”¯æŒ**ï¼šå†…ç½®ä¸»æµè¯„ä¼°åŸºå‡†ï¼Œæ”¯æŒè‡ªå®šä¹‰è¯„ä¼°æ ‡å‡†
- **æ™ºèƒ½è¯„åˆ†**ï¼šåŸºäºå¤§æ¨¡å‹çš„è‡ªåŠ¨è¯„åˆ†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§è¯„åˆ†ç­–ç•¥
- **æ•°æ®é›†ç®¡ç†**ï¼šæ”¯æŒQAã€MCQã€è‡ªå®šä¹‰æ ¼å¼æ•°æ®é›†çš„ä¸Šä¼ å’Œç®¡ç†
- **æ‰¹é‡è¯„ä¼°**ï¼šé«˜æ•ˆçš„æ‰¹é‡è¯„ä¼°å¤„ç†ï¼Œæ”¯æŒå¹¶å‘æ‰§è¡Œ

### ğŸ“Š æ€§èƒ½æµ‹è¯•
- **å‹åŠ›æµ‹è¯•**ï¼šæ”¯æŒå¹¶å‘æ€§èƒ½æµ‹è¯•ï¼Œå…¨é¢è¯„ä¼°æ¨¡å‹æœåŠ¡æ€§èƒ½
- **æŒ‡æ ‡åˆ†æ**ï¼šè¯¦ç»†çš„æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡ï¼ŒåŒ…æ‹¬å»¶è¿Ÿã€ååé‡ç­‰å…³é”®æŒ‡æ ‡
- **å¯è§†åŒ–æŠ¥å‘Š**ï¼šç›´è§‚çš„æ€§èƒ½æ•°æ®å±•ç¤ºå’Œåˆ†ææŠ¥å‘Š

### ğŸ›  ç®¡ç†åŠŸèƒ½
- **æ¨¡å‹ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†å¤šä¸ªLLMæ¨¡å‹ï¼Œæ”¯æŒAPIé…ç½®å’Œå¯†é’¥ç®¡ç†
- **ç”¨æˆ·æƒé™**ï¼šå®Œå–„çš„ç”¨æˆ·æƒé™æ§åˆ¶ï¼Œæ”¯æŒå¤šç”¨æˆ·åä½œ
- **ç»“æœå¯¼å‡º**ï¼šæ”¯æŒè¯„ä¼°ç»“æœå¯¼å‡ºä¸ºExcelç­‰æ ¼å¼

### ğŸ¨ ç”¨æˆ·ä½“éªŒ
- **ç°ä»£åŒ–UI**ï¼šåŸºäºDaisyUIçš„ç¾è§‚ç•Œé¢è®¾è®¡
- **å“åº”å¼å¸ƒå±€**ï¼šå®Œç¾é€‚é…æ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯
- **å®æ—¶æ›´æ–°**ï¼šè¯„ä¼°ä»»åŠ¡çŠ¶æ€å®æ—¶æ›´æ–°ï¼Œæ— éœ€æ‰‹åŠ¨åˆ·æ–°

### ğŸ“¸ åŠŸèƒ½æˆªå›¾

#### æ¨¡å‹ç®¡ç†
![æ¨¡å‹ç®¡ç†](./screenshots/101.png)

#### å¤šæ¨¡å‹å¯¹è¯
![å¤šæ¨¡å‹å¯¹è¯](./screenshots/102.png)

#### æ•°æ®é›†ç®¡ç†
![æ•°æ®é›†ç®¡ç†](./screenshots/103.png)

#### æ¨¡å‹æ•ˆæœè¯„ä¼°
![æ•ˆæœè¯„ä¼°](./screenshots/104.png)
![è¯„ä¼°æŠ¥å‘Š](./screenshots/105.png)
![è¯„ä¼°è¯¦æƒ…](./screenshots/106.png)

#### æ¨¡å‹æ€§èƒ½è¯„ä¼°
![æ€§èƒ½è¯„ä¼°](./screenshots/107.png)
![è¯„ä¼°æŠ¥å‘Š](./screenshots/108.png)

## ğŸƒâ€â™‚ï¸ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- MySQL 5.7+

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-repo/llm-eva.git
cd llm-eva

# å®‰è£…ä¾èµ– [evalscopeä¾èµ–è¾ƒå¤šè€å¿ƒç­‰å¾…]
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
cp .flaskenv.example .flaskenv
# ç¼–è¾‘ .flaskenv æ–‡ä»¶ï¼Œå¡«å…¥æ•°æ®åº“é…ç½®ç­‰ä¿¡æ¯

# å¯åŠ¨åº”ç”¨
python run.py --port 5000
```

è®¿é—® `http://localhost:5000` å¼€å§‹ä½¿ç”¨ã€‚

### Dockeréƒ¨ç½²

```bash
# ä½¿ç”¨ Docker Compose å¿«é€Ÿéƒ¨ç½²
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥æ•°æ®åº“é…ç½®ç­‰ä¿¡æ¯
docker-compose up -d
```

## ğŸ“š ä½¿ç”¨æŒ‡å—

### æ·»åŠ æ¨¡å‹

1. è¿›å…¥"æ¨¡å‹ç®¡ç†"é¡µé¢
2. ç‚¹å‡»"æ·»åŠ æ¨¡å‹"
3. å¡«å…¥æ¨¡å‹åç§°ã€APIåœ°å€ã€å¯†é’¥ç­‰ä¿¡æ¯
4. ä¿å­˜é…ç½®

### ä¸Šä¼ æ•°æ®é›†

1. è¿›å…¥"æ•°æ®é›†ç®¡ç†"é¡µé¢
2. é€‰æ‹©æ•°æ®é›†æ ¼å¼ï¼ˆQA/MCQ/è‡ªå®šä¹‰ï¼‰
3. ä¸Šä¼ JSONæ ¼å¼çš„æ•°æ®æ–‡ä»¶
4. é…ç½®åŸºå‡†ç±»å‹å’Œç›¸å…³å‚æ•°

### åˆ›å»ºè¯„ä¼°ä»»åŠ¡

1. è¿›å…¥"è¯„ä¼°ç®¡ç†"é¡µé¢
2. é€‰æ‹©è¦è¯„ä¼°çš„æ¨¡å‹å’Œæ•°æ®é›†
3. é…ç½®è¯„ä¼°å‚æ•°ï¼ˆæ¸©åº¦ã€æœ€å¤§Tokenç­‰ï¼‰
4. å¯åŠ¨è¯„ä¼°ä»»åŠ¡

### æ€§èƒ½æµ‹è¯•

1. è¿›å…¥"æ€§èƒ½è¯„ä¼°"é¡µé¢
2. é€‰æ‹©ç›®æ ‡æ¨¡å‹å’Œæµ‹è¯•æ•°æ®é›†
3. è®¾ç½®å¹¶å‘æ•°å’Œè¯·æ±‚æ•°é‡
4. æŸ¥çœ‹æ€§èƒ½æµ‹è¯•æŠ¥å‘Š

## ğŸ” æ”¯æŒçš„æ•°æ®æ ¼å¼

### QAæ ¼å¼
```json
{
  "system": "ä½ æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹",
  "query": "ä»€ä¹ˆæ˜¯æœºå™¨å­¦ä¹ ï¼Ÿ",
  "response": "æœºå™¨å­¦ä¹ æ˜¯äººå·¥æ™ºèƒ½çš„ä¸€ä¸ªåˆ†æ”¯..."
}
```

### MCQæ ¼å¼
```json
{
  "question": "ä»¥ä¸‹å“ªä¸ªæ˜¯æœºå™¨å­¦ä¹ ç®—æ³•ï¼Ÿ",
  "A": "çº¿æ€§å›å½’",
  "B": "æ•°æ®æ¸…æ´—", 
  "C": "æ•°æ®å¯è§†åŒ–",
  "D": "æ•°æ®å­˜å‚¨",
  "answer": "A"
}
```

### è‡ªå®šä¹‰æ ¼å¼
```json
{
  "history": [
    {"user": "ä½ å¥½", "assistant": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ"}
  ],
  "question": "è¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±",
  "answer": "æˆ‘æ˜¯ä¸€ä¸ªAIåŠ©æ‰‹ï¼Œå¯ä»¥å¸®åŠ©å›ç­”é—®é¢˜..."
}
```

## ğŸ›  å¼€å‘

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

```bash
# å®‰è£…å¼€å‘ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
python run.py --debug
```

### è‡ªå®šä¹‰æ•°æ®é›†
å¦‚æœä½ çš„æ•°æ®é›†ä¸æ˜¯[é€‰æ‹©é¢˜](#qaæ ¼å¼)ã€[é—®ç­”é¢˜](#mcqæ ¼å¼)ï¼Œä½ å¯èƒ½éœ€è¦è‡ªå®šä¹‰æ•°æ®é›†æ¥æ»¡è¶³è‡ªå·±çš„éœ€æ±‚ã€‚
è‡ªå®šä¹‰æ•°æ®é›†ä½¿ç”¨Jinja2æ¨¡ç‰ˆæ¥å®ç°æ•°æ®å­—æ®µå’ŒæŒ‡æ ‡çš„å®šä¹‰ã€‚æ¨¡æ¿éœ€è¦åŒ…å«å®ï¼šgen_prompt, get_gold_answer, match, parse_pred_result,compute_metric

ä»¥è½åŸŸæŠ½æ§½ä¸ºä¾‹ï¼š
```jinja2
{# æ„å›¾è¯†åˆ«è¯„ä¼°æ¨¡æ¿ #}

{# 1. ç”Ÿæˆæç¤ºè¯ #}
{% macro gen_prompt(system_prompt, history, user_prompt) %}
{% set final_user_prompt = user_prompt %}
{% if history %}
    {% set history_prompt = '' %}
    {% for h in history %}
        {% for k, v in h.items() %}
            {% set history_prompt = history_prompt ~ k ~ ': ' ~ v ~ '\n' %}
        {% endfor %}
    {% endfor %}
    {% set final_user_prompt = "ç”¨æˆ·çš„å¯¹è¯å†…å®¹å¦‚ä¸‹ï¼š\n" ~ history_prompt ~ "user: " ~ user_prompt ~ "\nå¯ä»¥ä½¿ç”¨çš„å·¥å…·åŠå…¶å‚æ•°ä¸ºï¼š\n" %}
{% endif %}
{
    "system_prompt": {{ system_prompt | to_json }},
    "user_prompt": {{ final_user_prompt | to_json }}
}
{% endmacro %}

{# 2. è·å–æ ‡å‡†ç­”æ¡ˆ #}
{% macro get_gold_answer(input_d) %}
{{ input_d.get('answer', '') }}
{% endmacro %}

{# 3. è§£æé¢„æµ‹ç»“æœ #}
{% macro parse_pred_result(result) %}
{% set text = result.strip() %}
{% set text = text.strip("```json").strip("```") %}

{% set parsed = none %}
{% if text is string %}
    {% set parsed = text | from_json %}
{% endif %}

{% if parsed is not none %}
    {{ parsed | to_json }}
{% else %}
    {{ text }}
{% endif %}
{% endmacro %}

{# 4. æ¯”è¾ƒé¢„æµ‹ç»“æœå’Œæ ‡å‡†ç­”æ¡ˆ #}
{% macro match(gold, pred) %}
{# è°ƒè¯•æ—¥å¿—ï¼šè¾“å…¥å‚æ•° #}

{% set gold_data = gold | from_json %}
{% set pred_data = pred | from_json %}

{% if gold_data is mapping and pred_data is mapping %}
    {# æ¯”è¾ƒæ„å›¾ #}
    {% set intent_match = gold_data.get('intent', '') == pred_data.get('intent', '') %}
    
    {# æ¯”è¾ƒæ§½ä½ #}
    {% set gold_slots = gold_data.get('slots', {}) %}
    {% set pred_slots = pred_data.get('slots', {}) %}

    {# ä½¿ç”¨åˆ—è¡¨æ¥è®°å½•å„ç§æƒ…å†µ #}
    {% set miss_slots = [] %}
    {% set correct_slots = [] %}
    {% set fail_slots = [] %}
    
    {# éå†é»„é‡‘æ ‡å‡†ä¸­çš„æ§½ä½ #}
    {% for key, value in gold_slots.items() %}
        {% if value != '' %}
            {% if key not in pred_slots %}
                {% set _ = miss_slots.append(key) %}
            {% elif pred_slots[key] == value %}
                {% set _ = correct_slots.append(key) %}
            {% else %}
                {% set _ = fail_slots.append(key) %}
            {% endif %}
        {% endif %}
    {% endfor %}

    
    {# è®¡ç®—æœ€ç»ˆç»“æœ #}
    {% set miss_count = miss_slots | length %}
    {% set correct_count = correct_slots | length %}
    {% set fail_count = fail_slots | length %}
    
    {
        "intent_result": {{ intent_match | to_json }},
        "slots_result": {
            "miss_count": {{ miss_count }},
            "correct_count": {{ correct_count }},
            "fail_count": {{ fail_count }}
        }
    }
{% else %}
    {
        "intent_result": {{ (gold == pred) | to_json }},
        "slots_result": {
            "miss_count": 0,
            "correct_count": {{ 1 if gold == pred else 0 }},
            "fail_count": {{ 0 if gold == pred else 1 }}
        }
    }
{% endif %}
{% endmacro %}

{# 5. è®¡ç®—è¯„ä¼°æŒ‡æ ‡ #}
{% macro compute_metric(review_res_list) %}
{# ä½¿ç”¨åˆ—è¡¨æ¥è®°å½•å„ç§æƒ…å†µ #}
{% set intent_correct_list = [] %}
{% set tp_list = [] %}
{% set fp_list = [] %}
{% set fn_list = [] %}

{% for item in review_res_list %}
    {% if item.intent_result %}
        {% set _ = intent_correct_list.append(1) %}
        {% set _ = tp_list.append(item.slots_result.correct_count) %}
        {% set _ = fp_list.append(item.slots_result.fail_count) %}
        {% set _ = fn_list.append(item.slots_result.miss_count) %}
    {% endif %}
{% endfor %}

{% set intent_correct_count = intent_correct_list | sum %}
{% set all_tp = tp_list | sum %}
{% set all_fp = fp_list | sum %}
{% set all_fn = fn_list | sum %}

{% set precision = all_tp / (all_tp + all_fp + 1e-10) %}
{% set recall = all_tp / (all_tp + all_fn + 1e-10) %}
{% set f1 = 2 * precision * recall / (precision + recall + 1e-10) %}

[
    {
        "metric_name": "intent_correct_score",
        "score": {{ 0 if review_res_list|length == 0 else intent_correct_count * 1.0 / review_res_list|length }},
        "num": {{ review_res_list|length }}
    },
    {
        "metric_name": "slot_f1",
        "score": {{ f1 }},
        "num": {{ all_fn + all_fp + all_tp }}
    }
]
{% endmacro %}
```


### é¡¹ç›®ç»“æ„

```
llm-eva/
â”œâ”€â”€ app/                    # åº”ç”¨ä¸»ç›®å½•
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ templates/         # HTMLæ¨¡æ¿
â”‚   â””â”€â”€ static/            # é™æ€èµ„æº
â”œâ”€â”€ migrations/            # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ tests/                 # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ docker/               # Dockeré…ç½®
â”œâ”€â”€ requirements.txt      # Pythonä¾èµ–
â””â”€â”€ run.py               # å¯åŠ¨æ–‡ä»¶
```

### æŠ€æœ¯æ ˆ

- **åç«¯**ï¼šFlask + SQLAlchemy + MySQL
- **å‰ç«¯**ï¼šHTML + JavaScript + DaisyUI
- **è¯„ä¼°å¼•æ“**ï¼šEvalScope
- **ä»»åŠ¡é˜Ÿåˆ—**ï¼šCelery
- **éƒ¨ç½²**ï¼šDocker + Docker Compose

æ”¯æŒè‡ªå®šä¹‰åŸºå‡†çš„å¼€å‘å’Œé›†æˆã€‚

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

### å¦‚ä½•è´¡çŒ®

1. Fork è¿™ä¸ªé¡¹ç›®
2. åˆ›å»ºä½ çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤ä½ çš„æ”¹åŠ¨ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€ä¸€ä¸ª Pull Request

### å¼€å‘è§„èŒƒ

- éµå¾ª PEP 8 Python ä»£ç è§„èŒƒ
- æ·»åŠ é€‚å½“çš„æµ‹è¯•ç”¨ä¾‹
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0
- âœ¨ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- ğŸ¯ æ”¯æŒåŸºç¡€æ¨¡å‹è¯„ä¼°åŠŸèƒ½
- ğŸ“Š é›†æˆæ€§èƒ½æµ‹è¯•æ¨¡å—
- ğŸ›  å®Œæ•´çš„æ•°æ®é›†ç®¡ç†ç³»ç»Ÿ

## ğŸ†˜ å¸¸è§é—®é¢˜

### Q: å¦‚ä½•æ·»åŠ æ–°çš„è¯„ä¼°åŸºå‡†ï¼Ÿ
A: å¯ä»¥é€šè¿‡æ‰©å±• EvalScope çš„é€‚é…å™¨æ¥æ·»åŠ è‡ªå®šä¹‰åŸºå‡†ï¼Œè¯¦è§å¼€å‘æ–‡æ¡£ã€‚

### Q: æ”¯æŒå“ªäº›æ¨¡å‹APIæ ¼å¼ï¼Ÿ
A: æ”¯æŒ OpenAI å…¼å®¹çš„ API æ ¼å¼ï¼ŒåŒ…æ‹¬å¤§éƒ¨åˆ†ä¸»æµå¤§æ¨¡å‹æœåŠ¡ã€‚

### Q: å¦‚ä½•å¤„ç†å¤§è§„æ¨¡æ•°æ®é›†ï¼Ÿ
A: ç³»ç»Ÿæ”¯æŒåˆ†æ‰¹å¤„ç†å’Œå¼‚æ­¥ä»»åŠ¡ï¼Œå¯ä»¥å¤„ç†å¤§è§„æ¨¡è¯„ä¼°ä»»åŠ¡ã€‚

### Q: è¿˜æ”¯æŒå“ªäº›é€šç”¨æ•°æ®é›†ï¼Ÿ
å‚è€ƒ[supported_dataset](https://evalscope.readthedocs.io/zh-cn/latest/get_started/supported_dataset.html#id2)

## ğŸ“„ å¼€æºåè®®

æœ¬é¡¹ç›®åŸºäº [MIT License](LICENSE) å¼€æºåè®®ã€‚

## ğŸ™ è‡´è°¢

- [EvalScope](https://github.com/modelscope/evalscope) - æä¾›å¼ºå¤§çš„è¯„ä¼°å¼•æ“
- [DaisyUI](https://daisyui.com/) - ä¼˜é›…çš„UIç»„ä»¶åº“
- [Flask](https://flask.palletsprojects.com/) - è½»é‡çº§Webæ¡†æ¶

---

<div align="center">
å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ª â­ï¸ï¼
</div>
